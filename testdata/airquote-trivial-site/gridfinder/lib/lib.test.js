import * as gridfinder from "./lib.js";
import assert from "assert";
import snapshot from "snap-shot-it";

it("perfect clicks", () => {
	snapshot(gridfinder.findGrid,
		[[
			{x: 0, y: 0},
			{x: 100, y: 100},
			{x: 200, y: 200},
		]],
		[[
			{x: 0, y: 0},
			{x: 72, y: 144},
			{x: 288, y: 72},
		]]);
});

it("very good clicks", () => {
	snapshot(gridfinder.findGrid,
		[[
			{x: 0, y: 0},
			{x: 110, y: 98},
			{x: 312, y: 302},
		]]);
});

it("60x60 https://i.redd.it/9xy7jbjw4wv11.jpg", () => {
	snapshot(gridfinder.findGrid,
		[[
			// Big grid!
			{x: 595.977798334875, y: 428.898055242918},
			{x: 595.977798334875, y: 306.6018226234514},
			{x: 721.7187789084181, y: 306.6018226234514},
			{x: 721.7187789084181, y: 431.48177846727293},
		]], [[
			// Actually I want half the size!
			{x: 595.977798334875, y: 428.898055242918},
			{x: 595.977798334875, y: 306.6018226234514},
			{x: 721.7187789084181, y: 306.6018226234514},
			{x: 721.7187789084181, y: 431.48177846727293},
			{x: 657.1258094357077, y: 375.50110860624955},
		]], [[
			// Half the size another way.
			{x: 595.977798334875, y: 428.898055242918},
			{x: 595.977798334875, y: 306.6018226234514},
			{x: 721.7187789084181, y: 306.6018226234514},
			{x: 721.7187789084181, y: 431.48177846727293},
			{x: 657.9870490286771, y: 429.75929631770305},
		]], [[
			{x: 1511.4754856614245, y: 1746.5968996639313},
			{x: 1580.3746530989824, y: 1917.9838735461417},
			{x: 1575.2072155411654, y: 2163.43757985986},
			{x: 1575.2072155411654, y: 1979.9932309306596},
			{x: 1637.2164662349676, y: 1919.7063556957116}
		]]);
})

it("256x256 https://i.redd.it/m6l4go8l56v51.jpg", () => {
	snapshot(gridfinder.findGrid,
		[[
			{x: 2597.300613496932, y: 1813.9973492199026},
			{x: 5119.018404907975, y: 2562.9583759811503},
			{x: 5119.018404907975, y: 2830.9352571159084},
		]], [[
			{x: 5119.018404907975, y: 2830.935257115908},
			{x: 5112.147239263804, y: 2562.958375981150},
			{x: 3600.490797546012, y: 2549.215971820393},
		]], [[
			// Selects a too small grid!
			{x: 1288.880666049953, y: 4604.322132248466},
			{x: 2573.617021276596, y: 1811.061000713393},
			{x: 3601.406105457909, y: 2557.035783615935},
		]], [[
			// Larger, but still too small.
			{x: 1288.880666049953, y: 4604.322132248466},
			{x: 2573.617021276596, y: 1811.061000713393},
			{x: 3601.406105457909, y: 2557.035783615935},
			{x: 5114.079555966698, y: 1811.061000713393},
		]], [[
			// Perfection.
			{x: 1288.880666049953, y: 4604.322132248466},
			{x: 2573.617021276596, y: 1811.061000713393},
			{x: 3601.406105457909, y: 2557.035783615935},
			{x: 5114.079555966698, y: 1811.061000713393},
			{x: 4102.867715078631, y: 3332.020696964687},
		]], [[
			// Lots and lots of points, good result.
			{x: 1288.880666049953, y: 4604.322132248466},
			{x: 2573.617021276596, y: 1811.061000713393},
			{x: 3601.406105457909, y: 2557.035783615935},
			{x: 5114.079555966698, y: 1811.061000713393},
			{x: 4102.867715078631, y: 3332.020696964687},
			{x: 3327.881591119334, y: 1790.339478966100},
			{x: 3601.406105457909, y: 3323.732088265769},
			{x: 2565.328399629972, y: 3323.732088265769},
			{x: 1284.736355226642, y: 3854.203044996466},
			{x: 2047.289546716003, y: 3858.347349345924},
			{x: 2043.145235892692, y: 4608.466436597925},
			{x: 2569.472710453284, y: 4608.466436597925},
			{x: 5114.079555966698, y: 2561.180087965393},
			{x: 5122.368177613321, y: 2822.271261981283},
			{x: 5114.079555966698, y: 3323.732088265769},
		]]);
})

